<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Urban Issues Dashboard</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f4f4f9; color: #333; margin: 0; padding: 20px; }
        h1 { color: #444; text-align: center; }
        #reports-container { max-width: 800px; margin: 20px auto; background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); padding: 20px; }
        .report-card { border-bottom: 1px solid #eee; padding: 15px; }
        .report-card:last-child { border-bottom: none; }
        .report-description { font-size: 1.1em; font-weight: 500; }
        .report-timestamp { font-size: 0.8em; color: #888; margin-top: 5px; }
        #placeholder { color: #999; text-align: center; padding: 40px; }
        .error-message { padding: 40px; text-align: center; color: #D8000C; background-color: #FFD2D2; border-radius: 8px; }
    </style>
</head>
<body>

    <h1>Live Citizen Reports</h1>

    <div id="reports-container">
        <div id="placeholder">Listening for new reports...</div>
        <!-- Reports will be dynamically added here -->
    </div>

    <!-- Import Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-firestore-compat.js"></script>

    <script>
        // --- IMPORTANT: PASTE YOUR FIREBASE CONFIGURATION HERE ---
        // You get this from the Firebase console when you register your web app.
        const firebaseConfig = {
            apiKey: "AIzaSyAy7ibJyu2Qn_BPTOT-Kmu-aGQ5X9jjOZ0",
            authDomain: "urban-management-platform.firebaseapp.com",
            projectId: "urban-management-platform",
            storageBucket: "urban-management-platform.appspot.com",
            messagingSenderId: "546491864177",
            appId: "1:546491864177:web:8c330c7f7b944a5fd337d0",
            measurementId: "G-CEVE67J0ZC"
        };
        // --- END OF CONFIGURATION ---


        const reportsContainer = document.getElementById('reports-container');
        const placeholder = document.getElementById('placeholder');

        // --- NEW: Check if the Firebase config is still using placeholder values ---
        if (firebaseConfig.apiKey === "YOUR_API_KEY" || firebaseConfig.projectId === "YOUR_PROJECT_ID") {
            console.error("FIREBASE CONFIGURATION ERROR: Please paste your project's firebaseConfig object into index.html");
            // Display a user-friendly error message on the page
            reportsContainer.innerHTML = `<div class="error-message">
                <h2>Configuration Error</h2>
                <p>Your Firebase configuration is missing or incorrect. Please copy the <code>firebaseConfig</code> object from your Firebase project settings and paste it into the <code>index.html</code> file to connect to the backend.</p>
            </div>`;
        } else {
            // --- Initialize Firebase and set up the listener ONLY if the config is valid ---
            firebase.initializeApp(firebaseConfig);
            const db = firebase.firestore();

            // REAL-TIME LISTENER: Listens for any changes in the "reports" collection.
            db.collection("reports")
              .orderBy("timestamp", "desc") // Show newest reports first
              .onSnapshot((querySnapshot) => {
                
                if (querySnapshot.empty) {
                    placeholder.style.display = 'block';
                    reportsContainer.innerHTML = ''; // Clear previous reports if collection becomes empty
                    reportsContainer.appendChild(placeholder);
                } else {
                    placeholder.style.display = 'none';
                    reportsContainer.innerHTML = ''; // Clear the container to avoid duplicates
                }

                // Loop through each document in the collection
                querySnapshot.forEach((doc) => {
                    const reportData = doc.data();

                    // Create HTML elements for the report card
                    const card = document.createElement('div');
                    card.className = 'report-card';

                    const description = document.createElement('p');
                    description.className = 'report-description';
                    description.textContent = reportData.description;

                    const timestamp = document.createElement('p');
                    timestamp.className = 'report-timestamp';
                    
                    // Format the timestamp to be readable (check if it exists)
                    if (reportData.timestamp && reportData.timestamp.toDate) {
                        const date = reportData.timestamp.toDate();
                        timestamp.textContent = `Reported on: ${date.toLocaleDateString()} at ${date.toLocaleTimeString()}`;
                    } else {
                        timestamp.textContent = 'Timestamp not available';
                    }

                    // Append the new elements to the card, and the card to the container
                    card.appendChild(description);
                    card.appendChild(timestamp);
                    reportsContainer.appendChild(card);
                });
            }, (error) => {
                // This will catch other Firestore errors (like permission denied)
                console.error("Firestore Error: ", error);
                 reportsContainer.innerHTML = `<div class="error-message">
                    <h2>Connection Error</h2>
                    <p>Could not connect to the database. Please check the console for details and ensure your Firestore security rules are correctly set up.</p>
                </div>`;
            });
        }

    </script>

</body>
</html>

